\documentclass{article}

% --- GESTION DES MARGES DE PAGE ---
\usepackage[a4paper, top=2.5cm, bottom=2.5cm, left=3cm, right=3cm]{geometry}

% --- PRÉAMBULE STANDARD ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[french]{babel}
\usepackage{parskip} % NOUVEAU : Supprime l'indentation et ajoute espace inter-paragraphe
\usepackage{xcolor}
\usepackage{tcolorbox}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{graphicx} % Requis pour inclure des images
\usepackage{amssymb} % Pour les symboles mathématiques comme \subseteq
\usepackage{sectsty} % Pour le style des sections
\usepackage{etoolbox} % Pour les conditions
\usepackage[dvipsnames]{xcolor}
\usepackage{pgfplots} % Le package principal pour les graphiques
\usepackage{enumitem}
\usepackage{diagbox}

\setlist[itemize,1]{label=$\cdot$}

\usetikzlibrary{
    matrix, 
    patterns.meta,
    calc,
    positioning,
    decorations.pathreplacing,
    trees,
    backgrounds
}

% Redéfinir le symbole pour le premier niveau de la liste
\renewcommand{\labelitemi}{$\cdot$}
\renewcommand{\labelitemii}{$\circ$}
\renewcommand{\labelitemiii}{$\ast$}

% Styles de hachures (inchangés)
\tikzset{
  red_hatch/.style={
    pattern={Lines[angle=45, line width=0.8pt, distance=4pt]}, 
    pattern color=red
  },
  blue_hatch/.style={
    pattern={Lines[angle=-45, line width=0.8pt, distance=4pt]}, 
    pattern color=blue
  },
  purple_hatch/.style={
    pattern={Lines[angle=45, line width=0.8pt, distance=4pt]}, 
    pattern color=red,
    postaction={
      pattern={Lines[angle=-45, line width=0.8pt, distance=4pt]}, 
      pattern color=blue
    }
  }
}

% --- BIBLIOTHÈQUES TCOLORBOX ---
\tcbuselibrary{listings, skins, breakable}

% --- GESTION DES LIENS HYPERTEXTE ---
\usepackage[colorlinks=true, linkcolor=black, urlcolor=blue]{hyperref}

% --- SOULIGNER LES TITRES ET SOUS-TITRES ---
\sectionfont{\underline}
\subsectionfont{\underline}

% --- PAGE DE GARDE AMÉLIORÉE ---
\makeatletter
\renewcommand{\maketitle}{%
\begin{titlepage}
\centering
\vspace*{\stretch{1.5}}
{\Huge \bfseries Mes Notes de Lecture\par}
\vspace{0.4cm}
\rule{0.8\linewidth}{0.4pt}
\vspace{1cm}
{\LARGE \bfseries Introduction à la Probabilité\par}
\vspace*{\stretch{2.5}}
{\Large \scshape Lou Brunet\par}
\vspace{0.5cm}
{\large \today\par}
\vspace*{\stretch{1}}
\end{titlepage}
}
\makeatother

% --- DÉFINITION DES COULEURS STYLE VS CODE ---
\definecolor{vscodeBlue}{HTML}{569CD6}
\definecolor{vscodeOrange}{HTML}{CE9178}
\definecolor{vscodeGreen}{HTML}{6A9955}
\definecolor{vscodePurple}{HTML}{C586C0}
\definecolor{vscodeGray}{HTML}{9B9B9B}
\definecolor{codeBackground}{HTML}{1E1E1E}

% --- CONFIGURATION DU STYLE LISTINGS ---
\lstdefinestyle{vscode}{
    language=Python,
    backgroundcolor=\color{codeBackground},
    basicstyle=\ttfamily\small\color{white},
    keywordstyle=\color{vscodeBlue},
    stringstyle=\color{vscodeOrange},
    commentstyle=\color{vscodeGreen},
    numberstyle=\tiny\color{vscodeGray},
    otherkeywords={self, True, False, None},
    keywordstyle=[2]\color{vscodePurple},
    showstringspaces=false,
    breaklines=true,
    frame=none,
    tabsize=4
}

% --- STYLE DE L'OUTPUT ---
\lstdefinestyle{outputstyle}{
    basicstyle=\ttfamily\small\color{white},
    breaklines=true,
    frame=none
}

% ==================================================================
% --- MODIFIÉ : DÉFINITION DES CELLULES DE CODE ET OUTPUT ---
% ==================================================================
% Elles utilisent maintenant le même style "sidebar" que les autres boîtes.

\newtcblisting{codecell}{
  skin=enhanced, % Pour la bordure latérale
  arc=0mm,       % Coins carrés
  boxrule=0pt,   % Pas de cadre
  colback=codeBackground, % Fond sombre (VS Code)
  borderline west={2pt}{0pt}{vscodeBlue}, % Barre latérale bleue
  fonttitle=\bfseries\color{vscodeBlue}, % Titre en bleu
  listing only,
  listing options={style=vscode, basicstyle=\ttfamily\footnotesize\color{white}},
  left=3mm, right=3mm, top=2mm, bottom=2mm, % Padding (identique à sidebarstyle)
  boxsep=0mm, % (identique à sidebarstyle)
  breakable  % (identique à sidebarstyle)
}
\newtcblisting{outputcell}{
  skin=enhanced, % Pour la bordure latérale
  arc=0mm,       % Coins carrés
  boxrule=0pt,   % Pas de cadre
  colback=black!85, % Fond sombre (Output)
  borderline west={2pt}{0pt}{corrColor}, % Barre latérale grise
  fonttitle=\bfseries\color{corrColor}, % Titre en gris
  listing only,
  listing options={style=outputstyle, basicstyle=\ttfamily\footnotesize\color{white}},
  left=3mm, right=3mm, top=2mm, bottom=2mm, % Padding (identique à sidebarstyle)
  boxsep=0mm, % (identique à sidebarstyle)
  breakable  % (identique à sidebarstyle)
}

% --- DÉFINITION DES COULEURS POUR DÉF/THÉO/PREUVE/INTUITION/EXEMPLE ---
\definecolor{defColor}{HTML}{1b1f3a}       % Bleu nuit pour les définitions
\definecolor{theoColor}{HTML}{53354a}      % Violet aubergine pour les théorèmes
\definecolor{proofColor}{HTML}{a64942}     % Rouge brique pour les preuves
\definecolor{intuitionColor}{HTML}{16A085} % Turquoise pour l'intuition
\definecolor{exampleColor}{HTML}{4a6982}   % Bleu ardoise pour les exemples
\definecolor{exoColor}{HTML}{1E8449}       % Vert
\definecolor{corrColor}{HTML}{7F8C8D}      % Gris
\definecolor{remarqueColor}{HTML}{D35400} 

% ==================================================================
% --- DÉFINITION DU STYLE DE BASE (MARGES RÉDUITES) ---
% ==================================================================

% --- STYLE "ORGANIQUE" AVEC BARRE LATÉRALE (Pour TOUTES les boîtes) ---
\tcbset{
    sidebarstyle/.style={
        skin=enhanced, % Nécessaire pour les bordures partielles
        arc=0mm,       % Coins carrés
        boxrule=0pt,   % Pas de cadre
        colback=white, % Fond blanc
        colframe=white,
        coltitle=white,
        fontupper=\color{black},
        left=3mm, right=3mm, top=2mm, bottom=2mm, % Padding interne réduit
        boxsep=0mm, % TRÈS IMPORTANT
        breakable
    }
}

% ==================================================================
% --- DÉFINITION DE TOUTES LES CELLULES (TEXTE) ---
% ==================================================================

% --- CELLULES "SIDEBAR" (Pour le contenu théorique) ---
\newtcolorbox{definitionbox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{defColor}, % Barre latérale gauche
  fonttitle=\bfseries\color{defColor},  % Titre en couleur (sans fond)
  title=Définition\ifstrempty{#1}{}{ : #1}
}
\newtcolorbox{theorembox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{theoColor},
  fonttitle=\bfseries\color{theoColor},
  title=Théorème\ifstrempty{#1}{}{ : #1}
}
\newtcolorbox{proofbox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{proofColor},
  fonttitle=\bfseries\color{proofColor},
  title=Preuve\ifstrempty{#1}{}{ : #1}
}
\newtcolorbox{intuitionbox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{intuitionColor},
  fonttitle=\bfseries\color{intuitionColor},
  title=Intuition\ifstrempty{#1}{}{ : #1}
}
\newtcolorbox{remarquebox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{remarqueColor},
  fonttitle=\bfseries\color{remarqueColor},
  title=Remarque\ifstrempty{#1}{}{ : #1}
}


% --- CELLULES "SIDEBAR" (Pour les applications) ---
\newtcolorbox{examplebox}[1][]{
  sidebarstyle,
  borderline west={2pt}{0pt}{exampleColor},
  fonttitle=\bfseries\color{exampleColor},
  title=Exemple\ifstrempty{#1}{}{ : #1}
}
\newtcolorbox{exercicebox}[1][]{
    sidebarstyle,
    borderline west={2pt}{0pt}{corrColor},
    fonttitle=\bfseries\color{corrColor},
    title=#1 % <-- On utilise directement l'argument fourni
}
\newtcolorbox{correctionbox}[1][]{
    sidebarstyle,
    borderline west={2pt}{0pt}{exoColor},
    fonttitle=\bfseries\color{exoColor},
    title=Correction\ifstrempty{#1}{}{ : #1}
}


% =============================================
% --- CORPS DU DOCUMENT ---
% =============================================
\begin{document}

\maketitle

\newpage
\tableofcontents 
\newpage

\input{section1.tex}
\input{section2.tex}
\input{section3.tex}
\input{section4.tex}
\input{section5.tex}
\input{section6.tex}
\input{section7.tex}
\input{section8.tex}

\input{appendice1.tex}

\section{Exemples de Code}

\begin{examplebox}[Simulation d'un lancer de dé]
On peut simuler $n$ lancers d'un dé équilibré à 6 faces en utilisant la bibliothèque \texttt{random} de Python.

\begin{codecell}
import random
import numpy
\end{codecell}

\begin{outputcell}
>> "vamonos"
\end{outputcell}

\end{examplebox}

\begin{definitionbox}[Variable Aléatoire]
Une variable aléatoire est une fonction qui associe un nombre réel à chaque résultat possible d'une expérience aléatoire.
\end{definitionbox}

\begin{codecell}
import math
import random

def poisson_knuth(lmbda: float) -> int:
  """
  Simule une variable aleatoire suivant une loi de Poisson()
  en utilisant l algorithme de Knuth.
  """
  L = math.exp(-lmbda)
  k = 0
  p = 1.0

  while p > L:
  k += 1
  p *= random.random()

  return k - 1
\end{codecell}


\end{document}